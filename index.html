<!--
Example from https://www.highcharts.com/demo/scatter
-->

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<div id="container" style="min-width: 310px; height: 500px; max-width: 900px; margin: 0 auto"></div>
<!--<div id="container" style="min-width: 310px; height: 800px; max-width: 1500px; margin: 0 auto"></div>-->

<script type="text/javascript">
    const HOURS_DAY = 24;
    const HOUR_MIN = 60;
    const DAY_MIN = HOUR_MIN * HOURS_DAY;

    const DOM = 0;
    const SEG = 1;
    const TER = 2;
    const QUA = 3;
    const QUI = 4;
    const SEX = 5;
    const SAB = 6;

    // week_day = int[0..6]
    // hour = int[0..23]
    // min = int[0..59]
    // week_start_on = sunday

    function week_day_to_str(week_day) {
        if (week_day === DOM) return 'Dom';
        if (week_day === SEG) return 'Seg';
        if (week_day === TER) return 'Ter';
        if (week_day === QUA) return 'Qua';
        if (week_day === QUI) return 'Qui';
        if (week_day === SEX) return 'Sex';
        if (week_day === SAB) return 'Sab';
    }

    function get_idx(week_day, hour, min) {
        return min + (hour * HOUR_MIN) + (week_day * DAY_MIN);
    }

    function zero_pad(val) {
        return ("00" + val).substr(-2, 2);
    }


    function get_str(idx) {
        if (idx < 0) return '--';

        idx = Math.trunc(idx);

        const week_day = Math.trunc(idx / DAY_MIN);
        if (week_day > SAB) return '--';
        const week_day_str = week_day_to_str(week_day);

        const aux_idx = idx - (week_day * DAY_MIN);
        const hour = Math.trunc(aux_idx / HOUR_MIN);

        const min = aux_idx - (hour * HOUR_MIN);
        return `${week_day_str} ${zero_pad(hour)}:${zero_pad(min)}`;
    }

    function marker_options(radius) {
        return {
            radius: radius || 10,
            // states: {
            //     hover: {
            //         enabled: true,
            //         lineColor: 'rgb(100,100,100)'
            //     }
            // }
        }
    }

    Highcharts.chart('container', {
        // chart: {
        //     type: 'scatter',
        //     zoomType: 'xy'
        // },
        chart: {
            type: 'bubble',
            plotBorderWidth: 1,
            zoomType: 'xy'
        },
        accessibility: {
            description: 'Grafico de dispersao que exibe em x o momento da semana e em y o numero de vitimas fatais'
        },
        title: {
            text: 'Vitimas fatais ao longo da semana'
        },
        subtitle: {
            text: 'Fonte: <a target="_blank" href="http://datapoa.com.br/dataset/acidentes-de-transito/">DataPoa</a>'
        },
        xAxis: {
            gridLineWidth: 1,
            plotLines: [{
                color: 'black',
                dashStyle: 'dot',
                width: 2,
                value: 65,
                label: {
                    rotation: 0,
                    y: 15,
                    style: {
                        fontStyle: 'italic'
                    },
                    text: 'Safe fat intake 65g/day'
                },
                zIndex: 3
            }],

            title: {
                enabled: true,
                text: 'Momento da semana'
            },
            startOnTick: true,
            endOnTick: true,
            showLastLabel: true,
            labels: {
                formatter: function () {
                    return get_str(this.value);
                }
            }
        },
        yAxis: {
            title: {text: 'Fatalidades'},

            startOnTick: false,
            endOnTick: false,
            labels: {
                format: '{value} gr'
            },
            maxPadding: 0.2,
            plotLines: [{
                color: 'black',
                dashStyle: 'dot',
                width: 2,
                value: 50,
                label: {
                    align: 'right',
                    style: {
                        fontStyle: 'italic'
                    },
                    text: 'Safe sugar intake 50g/day',
                    x: -10
                },
                zIndex: 3
            }]
        },
        legend: {
            layout: 'vertical',
            align: 'left',
            verticalAlign: 'top',
            x: 100, y: 70,
            floating: true,
            backgroundColor: Highcharts.defaultOptions.chart.backgroundColor,
            borderWidth: 1
        },
        plotOptions: {
            // scatter: {
            //     marker: {
            //         radius: 5,
            //         states: {
            //             hover: {
            //                 enabled: true,
            //                 lineColor: 'rgb(100,100,100)'
            //             }
            //         }
            //     },
            //     states: {
            //         hover: {
            //             marker: {
            //                 enabled: false
            //             }
            //         }
            //     },
            //     tooltip: {
            //         headerFormat: '<b>{series.name}</b><br>',
            //         // pointFormat: 'às {point.x} com {point.y} vitimas'
            //         pointFormatter: function () {
            //             const r = this.options.marker ? this.options.marker.radius : 1;
            //             return `${r} vezes às ${get_str(this.x)} com ${this.y} vitima(s)`;
            //         }
            //     }
            // }
            series: {
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [
            {
                name: 'Apenas carro(s)',
                // color: 'rgba(223, 83, 83, .5)',
                data: [
                    {x: 95, y: 95, z: 13.8, name: 'BE', country: 'Belgium'},
                    {x: 86.5, y: 102.9, z: 14.7, name: 'DE', country: 'Germany'},
                    {x: 80.8, y: 91.5, z: 15.8, name: 'FI', country: 'Finland'},
                ]
            },
            {
                name: 'Apenas moto(s)',
                // color: 'rgba(223, 83, 83, .5)',
                data: [
                    {x: 195, y: 295, z: 13.8, name: 'BE', country: 'Belgium'},
                    {x: 186.5, y: 2102.9, z: 14.7, name: 'DE', country: 'Germany'},
                    {x: 180.8, y: 291.5, z: 15.8, name: 'FI', country: 'Finland'},
                ]
            },
            // {
            //     name: 'Apenas moto(s)',
            //     // color: 'rgba(119, 152, 191, .5)',
            //     data: [
            //         [get_idx(SEG, 12, 24), 2],
            //     ]
            // }, {
            //     name: 'Apenas caminhao(oes)',
            //     // color: 'rgba(119, 152, 191, .5)',
            //     data: [
            //         [get_idx(TER, 3, 43), 3],
            //     ]
            // }, {
            //     name: 'Carro(s) e moto(s)',
            //     // color: 'rgba(119, 152, 191, .5)',
            //     data: [
            //         [get_idx(QUA, 20, 19), 0],
            //         [get_idx(QUA, 21, 19), 1],
            //         [get_idx(QUA, 22, 19), 2],
            //         [get_idx(QUA, 21, 19), 3],
            //         [get_idx(QUA, 20, 19), 4],
            //         [get_idx(SAB, 23, 59), 5],
            //     ]
            // },
        ],


        // tooltip: {
        //     useHTML: true,
        //     headerFormat: '<table>',
        //     pointFormat: '<tr><th colspan="2"><h3>{point.country}</h3></th></tr>' +
        //         '<tr><th>Fat intake:</th><td>{point.x}g</td></tr>' +
        //         '<tr><th>Sugar intake:</th><td>{point.y}g</td></tr>' +
        //         '<tr><th>Obesity (adults):</th><td>{point.z}%</td></tr>',
        //     footerFormat: '</table>',
        //     followPointer: true
        // },
    });
</script>